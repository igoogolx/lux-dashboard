"use strict";(self.webpackChunklux_dashboard=self.webpackChunklux_dashboard||[]).push([[558],{9558:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var n=a(7294),s=a(8726),r=a(3422),c=a(5998),i=a(7860),l=a(2580),o=a(2230),d=a(2327),m=a(8142),u=a(4184),p=a.n(u),E=a(5071),N=a(5093),O=a(1275);const y={directedInterfaceName:m.$.COMMON_DEFAULT_INTERFACE_NAME,directedInterfaceV4Addr:m.$.DEFAULT_INTERFACE_V4_ADDR,tunInterfaceName:m.$.COMMON_TUN_INTERFACE_NAME,localDns:m.$.SETTING_PRIMARY_DNS,remoteDns:m.$.SETTING_SECONDARY_DNS,hubAddress:m.$.HUB_ADDRESS};function v(e){const{close:t}=e,{t:a}=(0,d.$)(),[c,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{(0,r.Ch)().then((e=>{const t=(0,N.PR)();i({...e,hubAddress:(0,N.cu)(t)})}))}),[]),c?n.createElement(s.u_,{close:t},Object.keys(c).map((e=>{const t=Array.isArray(c[e])?c[e].join(","):c[e];return n.createElement("div",{className:"ebLK7cxSVnNCI3PQyquj",key:e},n.createElement("div",{className:"aT_orDrnf7YK2xjaQil6"},`${a(y[e])}:`),n.createElement("div",{className:"KWVl0L0jKFqAgmvNR9vb"},"hubAddress"===e?n.createElement(s.zx,{onClick:()=>{(0,O.LQ)(`http://${t}`)},buttonType:s.Bq.Link},t):t))}))):n.createElement(n.Fragment,null)}var S;function b(e){const{t}=(0,d.$)(),{className:a}=e,[r,i]=(0,n.useState)(!1),o=(0,c.v9)((e=>e.manager.isStared)),u=(0,E.jb)(),N=(0,c.v9)(l.hl.selectAll),O=(0,n.useMemo)((()=>[{id:S.TestDelay,content:t(m.$.CONNECTIVITY_TEST)},{id:S.RuntimeDetail,content:t(m.$.COMMON_RUNTIME_DETAIL),disabled:!o}]),[o,t]);return n.createElement(s.Lt,{items:O,onItemClick:e=>{(e=>{switch(e){case S.TestDelay:return void N.forEach((e=>{u(e.id)}));case S.RuntimeDetail:return void i(!0);default:throw new Error(`invalid ${e}`)}})(e)}},r&&n.createElement(v,{close:()=>{i(!1)}}),n.createElement(s.u,{content:t(m.$.MORE),placement:s.Um.Bottom},n.createElement(s.zx,{className:p()(a,"Fn_NUQLkCOXsRPxiH1Mm"),buttonType:s.Bq.Secondary},n.createElement(s.JO,{name:s.dT.Ellipsis,size:s.ZK.Normal}))))}!function(e){e.RuntimeDetail="0",e.TestDelay="1"}(S||(S={}));var f=a(9501);const g="MuKjtftNY9ztnXDqcJ8a",h={type:r.c0.Socks5,server:"",id:"",name:"",port:"",password:"",username:""},T=f.Ry().shape({name:f.Z_(),server:f.Z_().required("Required"),port:f.Rx().min(0).max(65535).required("Required"),username:f.Z_(),password:f.Z_()});function _(e){const{t}=(0,d.$)(),{close:a,initialValue:i,isSelected:o}=e,u=(0,c.I0)(),p=(0,c.v9)((e=>e.manager.isStared));return n.createElement(s.u_,{close:a},n.createElement(s.l0,{onSubmit:async e=>{const t={...e,port:Number(e.port)};if(i)await(0,r.Jc)({id:e.id,proxy:{...t}}),u(l.LF.actions.updateOne({proxy:t}));else{const{id:e}=await(0,r.qg)({proxy:{...t}});u(l.LF.actions.addOne({proxy:{...t,id:e}}))}a()},initialValues:i?(E=i,{...E,port:E.port.toString()}):h,validationSchema:T},(({dirty:e,submitForm:r})=>n.createElement(n.Fragment,null,n.createElement(s.gN,{name:"name",label:t(m.$.FORM_NAME)}),n.createElement(s.gN,{name:"server",label:t(m.$.FORM_SERVER)}),n.createElement(s.gN,{name:"port",label:t(m.$.FORM_PORT)}),n.createElement(s.gN,{name:"username",label:`${t(m.$.FORM_PASSWORD)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement(s.gN,{name:"password",label:`${t(m.$.FORM_USERNAME)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement("div",{className:"QlMnMn9UAfavOFPqZrAi"},n.createElement(s.zx,{onClick:a,className:g,buttonType:s.Bq.Secondary},t(m.$.FORM_CANCEL)),n.createElement(s.zx,{className:g,disabled:!e||o&&p,onClick:r},t(m.$.FORM_SAVE)))))));var E}var R=a(6647);const $=e=>{let t="";return Object.keys(e).forEach((a=>{const n=`${a}=${e[a]}`;t=t?`${t};${n}`:n})),t},C=e=>{const t={};return e.split(";").forEach((e=>{const a=e.split("=");if(2===a.length){const[e,n]=a;"obfs"===e?t.mode=n:"obfs-host"===e?t.host=n:t[e]=n}})),t},w=e=>{let t=`${e.plugin}`;return e["plugin-opts"]&&(t=`${t};${$(e["plugin-opts"])}`),R.SIP002_URI.stringify((0,R.makeConfig)({host:e.server,port:e.port,method:e.cipher,password:e.password,tag:e.name,plugin:t}))},I=e=>{if(!e)return"";const t=e.split(";");for(let e=0;e<t.length;e+=1){const a=t[e].split("=");if(2!==a.length)return"invalid opts";if(a.some((e=>0===e.length)))return"invalid opts"}return""},M=f.Ry().shape({name:f.Z_(),server:f.Z_().required("Required"),port:f.Rx().min(0).max(65535).required("Required"),password:f.Z_().required("Required"),method:f.Z_()}),A=["aes-128-gcm","aes-192-gcm","aes-256-gcm","rc4-md5","aes-128-cfb","aes-192-cfb","aes-256-cfb","aes-128-ctr","aes-192-ctr","aes-256-ctr","bf-cfb","camellia-128-cfb","camellia-192-cfbw","camellia-256-cfb","chacha20-ietf-poly1305","xchacha20-ietf-poly1305","salsa20","chacha20","chacha20-ietf"],k=["obfs","v2ray-plugin"],F="tbPXJE7qG49NQrO5pcXQ",L={type:r.c0.Shadowsocks,id:"",name:"",server:"",password:"",port:"",cipher:A[0]},D=e=>{const t={...e,pluginOptsStr:"",port:e.port.toString()};return t["plugin-opts"]&&(t.pluginOptsStr=$(t["plugin-opts"])),t},x=n.memo((e=>{const{close:t,initialValue:a,isSelected:i=!1}=e,{t:o}=(0,d.$)(),u=(0,c.I0)(),p=(0,n.useRef)(A.map((e=>({content:e,id:e})))),E=(0,n.useRef)(k.map((e=>({content:e,id:e})))),N=(0,c.v9)((e=>e.manager.isStared));return n.createElement(s.u_,{close:t},n.createElement(s.l0,{onSubmit:async e=>{const n=(e=>{const t={...e,port:Number(e.port)};return e.pluginOptsStr&&(t["plugin-opts"]=C(e.pluginOptsStr)),t})(e);if(a)await(0,r.Jc)({id:e.id,proxy:{...n}}),u(l.LF.actions.updateOne({proxy:n}));else{const{id:e}=await(0,r.qg)({proxy:{...n}});u(l.LF.actions.addOne({proxy:{...n,id:e}}))}t()},initialValues:a?D(a):L,validationSchema:M},(({dirty:e,submitForm:a,isValid:r,submitCount:c})=>n.createElement("div",{className:"fsQjdR7Qw8dmsp8FVrvG"},n.createElement(s.gN,{name:"name",label:o(m.$.FORM_NAME),size:s.vz.AUTO}),n.createElement(s.gN,{name:"server",label:o(m.$.FORM_SERVER),size:s.vz.AUTO}),n.createElement(s.VF,{name:"cipher",items:p.current,label:o(m.$.FORM_ENCRYPTION)}),n.createElement(s.gN,{name:"port",label:o(m.$.FORM_PORT),size:s.vz.AUTO,type:"number"}),n.createElement(s.BL,{name:"password",label:o(m.$.FORM_PASSWORD),size:s.vz.AUTO}),n.createElement(s.VF,{clearable:!0,selectorClassName:"XQ3eAcQdYdmRNADiUJFu",name:"plugin",items:E.current,label:`${o(m.$.FORM_PLUGIN)}(${o(m.$.FORM_OPTIONAL)})`}),n.createElement(s.gN,{name:"pluginOptsStr",label:`${o(m.$.FORM_PLUGIN_OPTS)}(${o(m.$.FORM_OPTIONAL)})`,size:s.vz.AUTO,validate:I}),n.createElement("div",{className:"n2wsynaxCESqyErl67wd"},n.createElement(s.zx,{onClick:t,className:F,buttonType:s.Bq.Secondary},o(m.$.FORM_CANCEL)),n.createElement(s.zx,{className:F,disabled:!e||!r&&c>0||i&&N,onClick:a},o(m.$.FORM_SAVE)))))))}));function P(e){const{type:t,close:a,initialValue:s,isSelected:c=!1}=e;switch(t){case r.c0.Shadowsocks:return n.createElement(x,{close:a,initialValue:s,isSelected:c});case r.c0.Socks5:return n.createElement(_,{close:a,initialValue:s,isSelected:c});default:throw new Error(`invalid ${t}`)}}var U;function q(e){const{className:t}=e,{t:a}=(0,d.$)(),[i,o]=(0,n.useState)(null),u=(0,c.I0)(),p=[{id:U.Shadowsocks,content:a(m.$.SHADOWSOCKS)},{id:U.Socks5,content:a(m.$.SOCKS5)},{id:U.Clipboard,content:a(m.$.CLIPBOARD_IMPORT)}];return n.createElement("div",{className:t},i&&n.createElement(P,{close:()=>{o(null)},type:i}),n.createElement(s.Lt,{items:p,onItemClick:e=>{(async e=>{switch(e){case U.Shadowsocks:o(r.c0.Shadowsocks);break;case U.Socks5:o(r.c0.Socks5);break;case U.Clipboard:{const e=(e=>e.split(/[\n\r ]/).map((e=>(e=>{const t={id:"",name:e.tag.data,server:e.host.data,port:e.port.data,cipher:e.method.data,password:e.password.data,udp:!0},a=e.extra.plugin;if(a){const e=a.indexOf(";");t.plugin=a.substring(0,e),t.plugin.includes("obfs")&&(t.plugin="obfs"),t["plugin-opts"]=C(a.substring(e+1))}return t})(R.SHADOWSOCKS_URI.parse(e)))))(await navigator.clipboard.readText());await Promise.all(e.map((async e=>{const t={...e,type:r.c0.Shadowsocks},a=await(0,r.qg)({proxy:t});u(l.LF.actions.addOne({proxy:{...t,id:a.id}}))})));break}default:throw new Error(`invalid ${e}`)}})(e)}},n.createElement(s.u,{content:"New Proxy",placement:s.Um.Bottom},n.createElement(s.JO,{name:s.dT.Plus,size:s.ZK.Medium,className:"lz8hAFMnw7ec0d3i_7Sg"}))))}!function(e){e[e.Shadowsocks=0]="Shadowsocks",e[e.Socks5=1]="Socks5",e[e.Clipboard=2]="Clipboard"}(U||(U={}));function z(){const{t:e}=(0,d.$)(),t=(0,c.v9)((e=>e.manager.isStared)),a=(0,c.v9)((e=>e.manager.isLoading)),[u,p]=(0,n.useState)(!1),E=(0,c.v9)((e=>!(!e.selected.proxy||!e.proxies.ids.includes(e.selected.proxy)))),N=(0,c.I0)(),O=(0,c.v9)(l.k8.selectAll),y=(0,c.v9)((e=>e.selected.rule));(0,n.useEffect)((()=>{(0,r.lR)().then((e=>{N(o.m.actions.setIsStarted({isStarted:e.isStarted}))})),(0,r.$c)().then((e=>{N(l.LU.actions.received(e)),N(i.m.actions.setRule({id:e.selectedId}))}))}),[N]);const v=(0,n.useCallback)((async e=>{try{p(!0),await(0,r.kY)({id:e}),N(i.m.actions.setRule({id:e}))}finally{p(!1)}}),[N]),S=(0,n.useMemo)((()=>O.map((t=>({id:t.id,content:e(t.id)})))),[O,e]),f=a||!E||u;return n.createElement("div",{className:"Gc8PPCFelr5RdihkBQG9"},n.createElement(b,null),n.createElement(q,{className:"t4XhkwkD25jmnZ5Lpit7"}),n.createElement(s.Qf,{items:S,onChange:e=>{v(e)},value:y,className:"Pxv6kA6NLwKWYIchoqmN",disabled:t||u}),n.createElement(s.u,{content:e(m.$.SWITCH_DISABLE_TIP),disabled:!f,timeout:1e3,placement:s.Um.Bottom},n.createElement(s.rs,{checked:t,onClick:async()=>{try{N(o.m.actions.setIsLoading({isLoading:!0})),t?await(0,r.sT)():await(0,r.BL)(),N(o.m.actions.setIsStarted({isStarted:!t}))}catch(e){s.rB.error(e.message||"unknown error")}finally{N(o.m.actions.setIsLoading({isLoading:!1}))}},disabled:f})))}const B={error:"B_lwM5S6on_QZjJtWFf7",warn:"CiO2Ztcm3IxAaKhLhrAA",success:"hFAcns3Z9iWsUoqjgUrg",loading:"Wig5XehzyXCQ0qjNTuPG",spin:"c9KBAYnOrZ6ojplykr_I"};var Q;function V(e){const{value:t,className:a,loading:r=!1,id:c}=e,i=(0,n.useMemo)((()=>t>0&&t<=1e3?Q.Success:t>1e3?Q.Warn:Q.Error),[t]),l=(0,E.jb)();return r?n.createElement(s.JO,{name:s.dT.Loading,className:p()(a,B.loading)}):n.createElement("span",{className:p()(a,B[i]),onClick:()=>{l(c)}},i===Q.Error?"timeout":`${t}ms`)}!function(e){e.Success="success",e.Warn="warn",e.Error="error"}(Q||(Q={}));var j=a(2592);const Z="qr-code";function K(e){const{url:t,close:a}=e,{t:r}=(0,d.$)();return(0,n.useEffect)((()=>{j.toCanvas(document.getElementById(Z),t).catch((e=>{s.rB.error(e.message||r(m.$.UNKNOWN_ERROR))}))}),[r,t]),n.createElement(s.u_,{close:a},n.createElement("div",{className:"dY96wPEsmrbJ5I9qiBbR"},n.createElement("canvas",{id:Z})))}var Y;function W(e){const{t}=(0,d.$)(),{id:a,className:o}=e,[u,N]=(0,n.useState)(!1),[O,y]=(0,n.useState)(!1),v=(0,c.I0)(),S=(0,E.jb)(),b=(0,E.dj)(),f=(0,c.v9)((e=>l.hl.selectById(e,a))),g=(0,c.v9)((e=>e.manager.isStared)),h=(0,c.v9)((e=>e.manager.isLoading)),T=(0,c.v9)((e=>e.selected.proxy===a)),_=(0,n.useMemo)((()=>{let e=[{id:Y.Edit,content:t(m.$.COMMON_EDIT),iconName:s.dT.Edit},{id:Y.Delete,content:t(m.$.COMMON_DELETE),iconName:s.dT.Trash,disabled:(g||h)&&T},{id:Y.Test,content:t(m.$.CONNECTIVITY_TEST),iconName:s.dT.Swap},{id:Y.TestUdp,content:t(m.$.COMMON_TEST_UDP),iconName:s.dT.Sync}];return f.type===r.c0.Shadowsocks&&(e=[...e,{id:Y.CopyUrl,content:t(m.$.COMMON_COPY_URL),iconName:s.dT.Copy},{id:Y.QrCode,content:t(m.$.COMMON_QR_CODE),iconName:s.dT.QrCode}]),e}),[T,g,h,f.type,t]);return n.createElement(s.Lt,{items:_,onItemClick:e=>{(async e=>{switch(e){case Y.Edit:return void N(!0);case Y.Delete:return await(0,r.M0)({id:f.id}),v(l.LF.actions.deleteOne({id:a})),T&&v(i.m.actions.setProxy({id:""})),void s.rB.success(t(m.$.DELETED));case Y.Test:return void await S(a);case Y.TestUdp:return void await b(a);case Y.CopyUrl:{const e=w(f);return await navigator.clipboard.writeText(e),void s.rB.success(t(m.$.COPIED))}case Y.QrCode:return void y(!0);default:throw new Error(`invalid ${e}`)}})(e)}},O&&n.createElement(K,{url:w(f),close:()=>{y(!1)}}),u&&n.createElement(P,{close:()=>N(!1),initialValue:f,type:f.type,isSelected:T}),n.createElement(s.zx,{className:p()(o,"NrZ2zb8qyzrYyf9bFMK9"),buttonType:s.Bq.Blank},n.createElement(s.JO,{name:s.dT.Ellipsis,size:s.ZK.Normal})))}function J(e){const{proxy:t}=e,a=(0,c.v9)((e=>e.selected.proxy===t.id)),o=(0,c.v9)((e=>l.Es.selectById(e,t.id)||null)),d=(0,c.I0)();return n.createElement("div",{className:"BDqzxjTLYTHStHMvmNmI"},n.createElement("div",{className:"lYrpMrjF0PH7IFULtHhQ"},n.createElement(W,{id:t.id})),n.createElement("div",{className:"mZncV2hoJ8gAfVYT7DsQ",onClick:async()=>{await(0,r.Hl)({id:t.id}),d(i.m.actions.setProxy({id:t.id}))}},n.createElement(s.oT,{type:a?s.ph.Enabled:s.ph.Disabled,className:"Qz25ryfV2M6JRobSdAxP"}),o&&n.createElement(V,{id:t.id,value:o.value||0,className:"GjErTTRcbaE0O4QUgiXu",loading:o.loading}),n.createElement("div",{className:"zoQOAH9PoHt3wZZs50KA"},t.type),n.createElement("div",{className:"fh7g3GBT4vJMenzh5jW1"},n.createElement("div",{className:"nitftQKt7tDMzoThVThE"},t.name||`${t.server}:${t.port}`))))}function H(){const e=(0,c.v9)(l.hl.selectAll),t=(0,c.I0)();return(0,n.useEffect)((()=>{(0,r.yi)().then((e=>{t(l.LF.actions.received(e)),t(i.m.actions.setProxy({id:e.selectedId}))}))}),[t]),n.createElement("div",{className:"_TBifi4dkudWb4MUgm4j"},e.map((e=>n.createElement(J,{proxy:e,key:e.id}))))}function G(){return n.createElement("div",{className:"makDUtZ7nLl5YwLZ_81d"},n.createElement("div",{className:"rHoRQy73BKWNrkFngo76"},n.createElement(z,null)),n.createElement("div",{className:"aAnpLd7JizxJyCv19aWV"},n.createElement(H,null)))}!function(e){e.Edit="edit",e.Delete="delete",e.CopyUrl="copyUrl",e.Test="test",e.QrCode="qrCode",e.TestUdp="testUdp"}(Y||(Y={}))},5071:(e,t,a)=>{a.d(t,{dj:()=>E,jb:()=>p,jf:()=>u});var n=a(7294),s=a(1560),r=a(4021),c=a(5998),i=a(3422),l=a(842),o=a(8726),d=a(8142),m=a(2327);const u=e=>{const t=(0,n.useRef)(null),a=(0,n.useRef)();return(0,n.useEffect)((()=>{if(t.current&&!a.current){const n=t.current;n&&(a.current=new s.kL(n,e))}}),[e]),[t,a.current]},p=()=>{const e=(0,c.I0)();return(0,n.useCallback)((async t=>{e(r.D.actions.updateOne({delay:{id:t,loading:!0}}));try{const a=await(0,i.NP)({id:t});e(r.D.actions.updateOne({delay:{id:t,value:a.delay}}))}catch(a){e(r.D.actions.updateOne({delay:{id:t,value:-1}}))}finally{e(r.D.actions.updateOne({delay:{id:t,loading:!1}}))}}),[e])},E=()=>{const e=(0,c.I0)(),{t}=(0,m.$)();return(0,n.useCallback)((async a=>{e(l.b.actions.updateOne({data:{id:a,loading:!0}}));try{const n=await(0,i.Z9)({id:a});e(l.b.actions.updateOne({data:{id:a,result:n.result}})),n.result?o.rB.success(t(d.$.UDP_OK_NOTIFICATION)):o.rB.error(t(d.$.UDP_FAILED_NOTIFICATION))}catch(t){e(l.b.actions.updateOne({data:{id:a,result:!1}}))}finally{e(l.b.actions.updateOne({data:{id:a,loading:!1}}))}}),[e,t])}}}]);