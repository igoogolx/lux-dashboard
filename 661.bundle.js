"use strict";(self.webpackChunklux_dashboard=self.webpackChunklux_dashboard||[]).push([[661],{1661:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});var n=a(7294),s=a(7089),r=a(6667),c=a(5998),i=a(7860),l=a(2580),o=a(2230),d=a(2327),m=a(8142),u=a(4184),p=a.n(u),E=a(5071),O=a(5093),N=a(1275);const y={directedInterfaceName:m.$.COMMON_DEFAULT_INTERFACE_NAME,directedInterfaceV4Addr:m.$.DEFAULT_INTERFACE_V4_ADDR,tunInterfaceName:m.$.COMMON_TUN_INTERFACE_NAME,localDns:m.$.SETTING_PRIMARY_DNS,remoteDns:m.$.SETTING_SECONDARY_DNS,hubAddress:m.$.HUB_ADDRESS};function S(e){const{close:t}=e,{t:a}=(0,d.$)(),[c,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{(0,r.Ch)().then((e=>{const t=(0,O.PR)();i({...e,hubAddress:(0,O.cu)(t)})}))}),[]),c?n.createElement(s.u_,{close:t},Object.keys(c).map((e=>{const t=Array.isArray(c[e])?c[e].join(","):c[e];return n.createElement("div",{className:"Udu6yxXNAw2wiYHcCkxp",key:e},n.createElement("div",{className:"b34Cp04_t9qyotfpwaEw"},`${a(y[e])}:`),n.createElement("div",{className:"iLbXplUrNoA6yC3Ij5cA"},"hubAddress"===e?n.createElement(s.zx,{onClick:()=>{(0,N.LQ)(`http://${t}`)},buttonType:s.Bq.Link},t):t))}))):n.createElement(n.Fragment,null)}var b;function v(e){const{t}=(0,d.$)(),{className:a}=e,[r,i]=(0,n.useState)(!1),o=(0,c.v9)((e=>e.manager.isStared)),u=(0,E.jb)(),O=(0,c.v9)(l.hl.selectAll),N=(0,n.useMemo)((()=>[{id:b.TestDelay,content:t(m.$.CONNECTIVITY_TEST)},{id:b.RuntimeDetail,content:t(m.$.COMMON_RUNTIME_DETAIL),disabled:!o}]),[o,t]);return n.createElement(s.Lt,{items:N,onItemClick:e=>{(e=>{switch(e){case b.TestDelay:return void O.forEach((e=>{u(e.id)}));case b.RuntimeDetail:return void i(!0);default:throw new Error(`invalid ${e}`)}})(e)}},r&&n.createElement(S,{close:()=>{i(!1)}}),n.createElement(s.u,{content:t(m.$.MORE),placement:s.Um.Bottom},n.createElement(s.zx,{className:p()(a,"Fn_NUQLkCOXsRPxiH1Mm"),buttonType:s.Bq.Secondary},n.createElement(s.JO,{name:s.dT.Ellipsis,size:s.ZK.Normal}))))}!function(e){e.RuntimeDetail="0",e.TestDelay="1"}(b||(b={}));var _=a(9501);const g=65535,R="k6YMG5GNLGeeju5qUmNQ",T={type:r.c0.Http,server:"",id:"",name:"",port:1080,password:"",username:""},$=_.Ry().shape({name:_.Z_(),server:_.Z_().required("Required"),port:_.Rx().min(0).max(g).required("Required"),username:_.Z_(),password:_.Z_()});function h(e){const{t}=(0,d.$)(),{close:a,initialValue:i,isSelected:o}=e,u=(0,c.I0)(),p=(0,c.v9)((e=>e.manager.isStared));return n.createElement(s.u_,{close:a},n.createElement(s.l0,{onSubmit:async e=>{if(i)await(0,r.Jc)({id:e.id,proxy:e}),u(l.LF.actions.updateOne({proxy:e}));else{const{id:t}=await(0,r.qg)({proxy:e});u(l.LF.actions.addOne({proxy:{...e,id:t}}))}a()},initialValues:i||T,validationSchema:$},(({dirty:e,submitForm:r})=>n.createElement(n.Fragment,null,n.createElement(s.gN,{name:"name",label:t(m.$.FORM_NAME)}),n.createElement(s.gN,{name:"server",label:t(m.$.FORM_SERVER)}),n.createElement(s.gN,{name:"port",label:t(m.$.FORM_PORT),type:"number"}),n.createElement(s.gN,{name:"username",label:`${t(m.$.FORM_PASSWORD)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement(s.gN,{name:"password",label:`${t(m.$.FORM_USERNAME)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement("div",{className:"SaBxbWlCJasQyDQpT6Sw"},n.createElement(s.zx,{onClick:a,className:R,buttonType:s.Bq.Secondary},t(m.$.FORM_CANCEL)),n.createElement(s.zx,{className:R,disabled:!e||o&&p,onClick:r},t(m.$.FORM_SAVE)))))))}const f="lFdYuErcPPvOrcvkQ_qr",C={type:r.c0.Socks5,server:"",id:"",name:"",port:1080,password:"",username:""},w=_.Ry().shape({name:_.Z_(),server:_.Z_().required("Required"),port:_.Rx().min(0).max(g).required("Required"),username:_.Z_(),password:_.Z_()});function M(e){const{t}=(0,d.$)(),{close:a,initialValue:i,isSelected:o}=e,u=(0,c.I0)(),p=(0,c.v9)((e=>e.manager.isStared));return n.createElement(s.u_,{close:a},n.createElement(s.l0,{onSubmit:async e=>{if(i)await(0,r.Jc)({id:e.id,proxy:e}),u(l.LF.actions.updateOne({proxy:e}));else{const{id:t}=await(0,r.qg)({proxy:e});u(l.LF.actions.addOne({proxy:{...e,id:t}}))}a()},initialValues:i||C,validationSchema:w},(({dirty:e,submitForm:r})=>n.createElement(n.Fragment,null,n.createElement(s.gN,{name:"name",label:t(m.$.FORM_NAME)}),n.createElement(s.gN,{name:"server",label:t(m.$.FORM_SERVER)}),n.createElement(s.gN,{name:"port",label:t(m.$.FORM_PORT),type:"number"}),n.createElement(s.gN,{name:"username",label:`${t(m.$.FORM_PASSWORD)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement(s.gN,{name:"password",label:`${t(m.$.FORM_USERNAME)}(${t(m.$.FORM_OPTIONAL)})`}),n.createElement("div",{className:"EBoNextEA3Qissmj96dg"},n.createElement(s.zx,{onClick:a,className:f,buttonType:s.Bq.Secondary},t(m.$.FORM_CANCEL)),n.createElement(s.zx,{className:f,disabled:!e||o&&p,onClick:r},t(m.$.FORM_SAVE)))))))}var A=a(6647);const I=e=>{let t="";return Object.keys(e).forEach((a=>{const n=`${a}=${e[a]}`;t=t?`${t};${n}`:n})),t},k=e=>{const t={};return e.split(";").forEach((e=>{const a=e.split("=");if(2===a.length){const[e,n]=a;"obfs"===e?t.mode=n:"obfs-host"===e?t.host=n:t[e]=n}})),t},F=e=>{let t=`${e.plugin}`;return e["plugin-opts"]&&(t=`${t};${I(e["plugin-opts"])}`),A.SIP002_URI.stringify((0,A.makeConfig)({host:e.server,port:e.port,method:e.cipher,password:e.password,tag:e.name,plugin:t}))},x=e=>{if(!e)return"";const t=e.split(";");for(let e=0;e<t.length;e+=1){const a=t[e].split("=");if(2!==a.length)return"invalid opts";if(a.some((e=>0===e.length)))return"invalid opts"}return""},L=_.Ry().shape({name:_.Z_(),server:_.Z_().required("Required"),port:_.Rx().min(0).max(g).required("Required"),password:_.Z_().required("Required"),method:_.Z_()}),D=["aes-128-gcm","aes-192-gcm","aes-256-gcm","rc4-md5","aes-128-cfb","aes-192-cfb","aes-256-cfb","aes-128-ctr","aes-192-ctr","aes-256-ctr","bf-cfb","camellia-128-cfb","camellia-192-cfbw","camellia-256-cfb","chacha20-ietf-poly1305","xchacha20-ietf-poly1305","salsa20","chacha20","chacha20-ietf"],P=["obfs","v2ray-plugin"],U="Y_sTMjn3xzjL5Yi0lfbw",q={type:r.c0.Shadowsocks,id:"",name:"",server:"",password:"",port:1080,cipher:D[0]},B=e=>{const t={...e,pluginOptsStr:""};return t["plugin-opts"]&&(t.pluginOptsStr=I(t["plugin-opts"])),t},z=n.memo((e=>{const{close:t,initialValue:a,isSelected:i=!1}=e,{t:o}=(0,d.$)(),u=(0,c.I0)(),p=(0,n.useRef)(D.map((e=>({content:e,id:e})))),E=(0,n.useRef)(P.map((e=>({content:e,id:e})))),O=(0,c.v9)((e=>e.manager.isStared));return n.createElement(s.u_,{close:t},n.createElement(s.l0,{onSubmit:async e=>{const n=(e=>{const t={...e};return t.pluginOptsStr&&(t["plugin-opts"]=k(t.pluginOptsStr)),delete t.pluginOptsStr,t})(e);if(a)await(0,r.Jc)({id:e.id,proxy:{...n}}),u(l.LF.actions.updateOne({proxy:n}));else{const{id:e}=await(0,r.qg)({proxy:{...n}});u(l.LF.actions.addOne({proxy:{...n,id:e}}))}t()},initialValues:a?B(a):q,validationSchema:L},(({dirty:e,submitForm:a,isValid:r,submitCount:c})=>n.createElement("div",{className:"qc0j8qlJrLZCU2O9RosZ"},n.createElement(s.gN,{name:"name",label:o(m.$.FORM_NAME),size:s.vz.AUTO}),n.createElement(s.gN,{name:"server",label:o(m.$.FORM_SERVER),size:s.vz.AUTO}),n.createElement(s.VF,{name:"cipher",items:p.current,label:o(m.$.FORM_ENCRYPTION)}),n.createElement(s.gN,{name:"port",label:o(m.$.FORM_PORT),size:s.vz.AUTO,type:"number"}),n.createElement(s.BL,{name:"password",label:o(m.$.FORM_PASSWORD),size:s.vz.AUTO}),n.createElement(s.VF,{clearable:!0,selectorClassName:"Ij9xQkzOZs3uu_xlCXAq",name:"plugin",items:E.current,label:`${o(m.$.FORM_PLUGIN)}(${o(m.$.FORM_OPTIONAL)})`}),n.createElement(s.gN,{name:"pluginOptsStr",label:`${o(m.$.FORM_PLUGIN_OPTS)}(${o(m.$.FORM_OPTIONAL)})`,size:s.vz.AUTO,validate:x}),n.createElement("div",{className:"_Q_MjOo3GU3F8qKQ9unB"},n.createElement(s.zx,{onClick:t,className:U,buttonType:s.Bq.Secondary},o(m.$.FORM_CANCEL)),n.createElement(s.zx,{className:U,disabled:!e||!r&&c>0||i&&O,onClick:a},o(m.$.FORM_SAVE)))))))}));function Z(e){const{type:t,close:a,initialValue:s,isSelected:c=!1}=e;switch(t){case r.c0.Shadowsocks:return n.createElement(z,{close:a,initialValue:s,isSelected:c});case r.c0.Socks5:return n.createElement(M,{close:a,initialValue:s,isSelected:c});case r.c0.Http:return n.createElement(h,{close:a,initialValue:s,isSelected:c});default:throw new Error(`invalid ${t}`)}}var V=a(7247);var j;function H(e){const{className:t}=e,{t:a}=(0,d.$)(),[i,o]=(0,n.useState)(null),u=(0,c.I0)(),p=[{id:j.Shadowsocks,content:a(m.$.SHADOWSOCKS)},{id:j.Socks5,content:a(m.$.SOCKS5)},{id:j.Http,content:a(m.$.HTTP)},{id:j.Clipboard,content:a(m.$.CLIPBOARD_IMPORT)},{id:j.CLASH,content:a(m.$.CLASH_IMPORT)}];return n.createElement("div",{className:t},i&&n.createElement(Z,{close:()=>{o(null)},type:i}),n.createElement(s.Lt,{items:p,onItemClick:e=>{(async e=>{switch(e){case j.Shadowsocks:o(r.c0.Shadowsocks);break;case j.Socks5:o(r.c0.Socks5);break;case j.Http:o(r.c0.Http);break;case j.Clipboard:{const e=(e=>e.split(/[\n\r ]/).map((e=>(e=>{const t={type:r.c0.Shadowsocks,id:"",name:e.tag.data,server:e.host.data,port:e.port.data,cipher:e.method.data,password:e.password.data,udp:!0},a=e.extra.plugin;if(a){const e=a.indexOf(";");t.plugin=a.substring(0,e),t.plugin.includes("obfs")&&(t.plugin="obfs"),t["plugin-opts"]=k(a.substring(e+1))}return t})(A.SHADOWSOCKS_URI.parse(e)))))(await navigator.clipboard.readText());await Promise.all(e.map((async e=>{const t={...e,type:r.c0.Shadowsocks},a=await(0,r.qg)({proxy:t});u(l.LF.actions.addOne({proxy:{...t,id:a.id}}))})));break}case j.CLASH:{const e=await navigator.clipboard.readText(),t=(0,V.Qc)(e);await Promise.all(t.proxies.map((async e=>{const t=await(0,r.qg)({proxy:e});u(l.LF.actions.addOne({proxy:{...e,id:t.id}}))})));break}default:throw new Error(`invalid ${e}`)}})(e)}},n.createElement(s.u,{content:"New Proxy",placement:s.Um.Bottom},n.createElement(s.JO,{name:s.dT.Plus,size:s.ZK.Medium,className:"lz8hAFMnw7ec0d3i_7Sg"}))))}!function(e){e[e.Shadowsocks=0]="Shadowsocks",e[e.Socks5=1]="Socks5",e[e.Clipboard=2]="Clipboard",e[e.Http=3]="Http",e[e.CLASH=4]="CLASH"}(j||(j={}));function Q(){const{t:e}=(0,d.$)(),t=(0,c.v9)((e=>e.manager.isStared)),a=(0,c.v9)((e=>e.manager.isLoading)),[u,p]=(0,n.useState)(!1),E=(0,c.v9)((e=>!(!e.selected.proxy||!e.proxies.ids.includes(e.selected.proxy)))),O=(0,c.I0)(),N=(0,c.v9)(l.k8.selectAll),y=(0,c.v9)((e=>e.selected.rule));(0,n.useEffect)((()=>{(0,r.lR)().then((e=>{O(o.m.actions.setIsStarted({isStarted:e.isStarted}))})),(0,r.$c)().then((e=>{O(l.LU.actions.received(e)),O(i.m.actions.setRule({id:e.selectedId}))}))}),[O]);const S=(0,n.useCallback)((async e=>{try{p(!0),await(0,r.kY)({id:e}),O(i.m.actions.setRule({id:e}))}finally{p(!1)}}),[O]),b=(0,n.useMemo)((()=>N.map((t=>({id:t.id,content:e(t.id)})))),[N,e]),_=a||!E||u;return n.createElement("div",{className:"Gc8PPCFelr5RdihkBQG9"},n.createElement(v,null),n.createElement(H,{className:"t4XhkwkD25jmnZ5Lpit7"}),n.createElement(s.Qf,{items:b,onChange:e=>{S(e)},value:y,className:"Pxv6kA6NLwKWYIchoqmN",disabled:t||u}),n.createElement(s.u,{content:e(m.$.SWITCH_DISABLE_TIP),disabled:!_,timeout:1e3,placement:s.Um.Bottom},n.createElement(s.rs,{checked:t,onClick:async()=>{try{O(o.m.actions.setIsLoading({isLoading:!0})),t?await(0,r.sT)():await(0,r.BL)(),O(o.m.actions.setIsStarted({isStarted:!t}))}catch(e){s.rB.error(e.message||"unknown error")}finally{O(o.m.actions.setIsLoading({isLoading:!1}))}},disabled:_})))}const Y={error:"B_lwM5S6on_QZjJtWFf7",warn:"CiO2Ztcm3IxAaKhLhrAA",success:"hFAcns3Z9iWsUoqjgUrg",loading:"Wig5XehzyXCQ0qjNTuPG",spin:"c9KBAYnOrZ6ojplykr_I"};var W;function J(e){const{value:t,className:a,loading:r=!1,id:c}=e,i=(0,n.useMemo)((()=>t>0&&t<=1e3?W.Success:t>1e3?W.Warn:W.Error),[t]),l=(0,E.jb)();return r?n.createElement(s.JO,{name:s.dT.Loading,className:p()(a,Y.loading)}):n.createElement("span",{className:p()(a,Y[i]),onClick:()=>{l(c)}},i===W.Error?"timeout":`${t}ms`)}!function(e){e.Success="success",e.Warn="warn",e.Error="error"}(W||(W={}));var K=a(2592);const G="qr-code";function X(e){const{url:t,close:a}=e,{t:r}=(0,d.$)();return(0,n.useEffect)((()=>{K.toCanvas(document.getElementById(G),t).catch((e=>{s.rB.error(e.message||r(m.$.UNKNOWN_ERROR))}))}),[r,t]),n.createElement(s.u_,{close:a},n.createElement("div",{className:"dY96wPEsmrbJ5I9qiBbR"},n.createElement("canvas",{id:G})))}var ee;function te(e){const{t}=(0,d.$)(),{id:a,className:o}=e,[u,O]=(0,n.useState)(!1),[N,y]=(0,n.useState)(!1),S=(0,c.I0)(),b=(0,E.jb)(),v=(0,E.dj)(),_=(0,c.v9)((e=>l.hl.selectById(e,a))),g=(0,c.v9)((e=>e.manager.isStared)),R=(0,c.v9)((e=>e.manager.isLoading)),T=(0,c.v9)((e=>e.selected.proxy===a)),$=(0,n.useMemo)((()=>{let e=[{id:ee.Test,content:t(m.$.CONNECTIVITY_TEST),iconName:s.dT.Swap},{id:ee.TestUdp,content:t(m.$.COMMON_TEST_UDP),iconName:s.dT.Sync},{id:ee.Delete,content:t(m.$.COMMON_DELETE),iconName:s.dT.Trash,disabled:(g||R)&&T,isDanger:!0,isDivider:!0}];return[r.c0.Shadowsocks,r.c0.Http,r.c0.Socks5].includes(_.type)?(e=[{id:ee.Edit,content:t(m.$.COMMON_EDIT),iconName:s.dT.Edit},...e],_.type===r.c0.Shadowsocks&&(e=[{id:ee.CopyUrl,content:t(m.$.COMMON_COPY_URL),iconName:s.dT.Copy},{id:ee.QrCode,content:t(m.$.COMMON_QR_CODE),iconName:s.dT.QrCode},...e]),e):e}),[T,g,R,_.type,t]);return n.createElement(s.Lt,{items:$,onItemClick:e=>{(async e=>{switch(e){case ee.Edit:return void O(!0);case ee.Delete:return await(0,r.M0)({id:_.id}),S(l.LF.actions.deleteOne({id:a})),T&&S(i.m.actions.setProxy({id:""})),void s.rB.success(t(m.$.DELETED));case ee.Test:return void await b(a);case ee.TestUdp:return void await v(a);case ee.CopyUrl:{const e=F(_);return await navigator.clipboard.writeText(e),void s.rB.success(t(m.$.COPIED))}case ee.QrCode:return void y(!0);default:throw new Error(`invalid ${e}`)}})(e)}},N&&n.createElement(X,{url:F(_),close:()=>{y(!1)}}),u&&n.createElement(Z,{close:()=>O(!1),initialValue:_,type:_.type,isSelected:T}),n.createElement(s.zx,{className:p()(o,"NrZ2zb8qyzrYyf9bFMK9"),buttonType:s.Bq.Blank},n.createElement(s.JO,{name:s.dT.Ellipsis,size:s.ZK.Normal})))}function ae(e){const{proxy:t}=e,a=(0,c.v9)((e=>e.selected.proxy===t.id)),o=(0,c.v9)((e=>l.Es.selectById(e,t.id)||null)),d=(0,c.I0)();return n.createElement("div",{className:"BDqzxjTLYTHStHMvmNmI"},n.createElement("div",{className:"lYrpMrjF0PH7IFULtHhQ"},n.createElement(te,{id:t.id})),n.createElement("div",{className:"mZncV2hoJ8gAfVYT7DsQ",onClick:async()=>{await(0,r.Hl)({id:t.id}),d(i.m.actions.setProxy({id:t.id}))}},n.createElement(s.oT,{type:a?s.ph.Enabled:s.ph.Disabled,className:"Qz25ryfV2M6JRobSdAxP"}),o&&n.createElement(J,{id:t.id,value:o.value||0,className:"GjErTTRcbaE0O4QUgiXu",loading:o.loading}),n.createElement("div",{className:"zoQOAH9PoHt3wZZs50KA"},t.type),n.createElement("div",{className:"fh7g3GBT4vJMenzh5jW1"},n.createElement("div",{className:"nitftQKt7tDMzoThVThE"},t.name||`${t.server}:${t.port}`))))}function ne(){const e=(0,c.v9)(l.hl.selectAll),t=(0,c.I0)();return(0,n.useEffect)((()=>{(0,r.yi)().then((e=>{t(l.LF.actions.received(e)),t(i.m.actions.setProxy({id:e.selectedId}))}))}),[t]),n.createElement("div",{className:"_TBifi4dkudWb4MUgm4j"},e.map((e=>n.createElement(ae,{proxy:e,key:e.id}))))}function se(){return n.createElement("div",{className:"makDUtZ7nLl5YwLZ_81d"},n.createElement("div",{className:"rHoRQy73BKWNrkFngo76"},n.createElement(Q,null)),n.createElement("div",{className:"aAnpLd7JizxJyCv19aWV"},n.createElement(ne,null)))}!function(e){e.Edit="edit",e.Delete="delete",e.CopyUrl="copyUrl",e.Test="test",e.QrCode="qrCode",e.TestUdp="testUdp"}(ee||(ee={}))},5071:(e,t,a)=>{a.d(t,{dj:()=>E,jb:()=>p,jf:()=>u});var n=a(7294),s=a(1560),r=a(4021),c=a(5998),i=a(6667),l=a(842),o=a(7089),d=a(8142),m=a(2327);const u=e=>{const t=(0,n.useRef)(null),a=(0,n.useRef)();return(0,n.useEffect)((()=>{if(t.current&&!a.current){const n=t.current;n&&(a.current=new s.kL(n,e))}}),[e]),[t,a.current]},p=()=>{const e=(0,c.I0)();return(0,n.useCallback)((async t=>{e(r.D.actions.updateOne({delay:{id:t,loading:!0}}));try{const a=await(0,i.NP)({id:t});e(r.D.actions.updateOne({delay:{id:t,value:a.delay}}))}finally{e(r.D.actions.updateOne({delay:{id:t,loading:!1}}))}}),[e])},E=()=>{const e=(0,c.I0)(),{t}=(0,m.$)();return(0,n.useCallback)((async a=>{e(l.b.actions.updateOne({data:{id:a,loading:!0}}));try{const n=await(0,i.Z9)({id:a});e(l.b.actions.updateOne({data:{id:a,result:n.result}})),n.result?o.rB.success(t(d.$.UDP_OK_NOTIFICATION)):o.rB.error(t(d.$.UDP_FAILED_NOTIFICATION))}catch(t){e(l.b.actions.updateOne({data:{id:a,result:!1}}))}finally{e(l.b.actions.updateOne({data:{id:a,loading:!1}}))}}),[e,t])}}}]);